<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trích Xuất Văn Bản Từ Ảnh</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.1/tesseract.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        pre { background: #f0f0f0; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Trích Xuất Văn Bản</h1>
        <input type="text" id="image-url" placeholder="Dán URL hoặc Ctrl+V hình ảnh" />
        <input type="file" id="file-input" accept="image/*" />
        <button id="extract-button">Trích Xuất</button>
        <h2>Kết Quả:</h2>
        <pre id="result"></pre>
    </div>

    <script>
        const imageUrlInput = document.getElementById('image-url');
        const fileInput = document.getElementById('file-input');
        const extractButton = document.getElementById('extract-button');
        const resultContainer = document.getElementById('result');

        // Xử lý ảnh từ URL hoặc file tải lên
        async function processImage(imageSrc) {
            const img = new Image();
            img.src = imageSrc;
            img.onload = async () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                // Chuyển ảnh sang đen trắng
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < imgData.data.length; i += 4) {
                    const avg = (imgData.data[i] + imgData.data[i + 1] + imgData.data[i + 2]) / 3;
                    imgData.data[i] = imgData.data[i + 1] = imgData.data[i + 2] = avg;
                }
                ctx.putImageData(imgData, 0, 0);

                // Nhận diện văn bản
                Tesseract.recognize(canvas.toDataURL(), 'vie', { logger: info => console.log(info) })
                    .then(({ data: { text } }) => {
                        resultContainer.textContent = text;
                    })
                    .catch(err => {
                        resultContainer.textContent = 'Lỗi: ' + err.message;
                    });
            };
        }

        // Xử lý sự kiện cho nút trích xuất
        extractButton.addEventListener('click', () => {
            const imageUrl = imageUrlInput.value.trim();
            if (imageUrl) {
                processImage(imageUrl);
            } else if (fileInput.files.length > 0) {
                processImage(URL.createObjectURL(fileInput.files[0]));
            } else {
                alert('Vui lòng dán URL hoặc chọn file!');
            }
        });

        // Xử lý dán hình ảnh từ clipboard
        imageUrlInput.addEventListener('paste', async (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let item of items) {
                if (item.kind === 'file') {
                    const file = item.getAsFile();
                    const imgUrl = URL.createObjectURL(file);
                    processImage(imgUrl);
                    imageUrlInput.value = ''; // Xóa ô nhập liệu sau khi dán
                    break; // Dừng lại sau khi dán một hình ảnh
                }
            }
        });

        // Xử lý sự kiện khi nhấn Enter trong ô nhập URL
        imageUrlInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') extractButton.click();
        });
    </script>
</body>
</html>
